!function(){function n(n,t,a,e){var r=a/2,i=8*e,o=4*e,c=r-o/2,l=r+i,d=Math.asin(c/l),u=Math.sqrt(1-Math.pow(c/l,2))*l,v=a+i+o,f=n/2,s=t-v,h=document.createElement("canvas");h.width=n,h.height=v;var p=h.getContext("2d");return p.lineJoin=p.lineCap="round",p.translate(f,v-r),p.moveTo(-f+o,-c),p.lineTo(-u,-c),p.arc(0,0,l,-Math.PI+d,-d),p.lineTo(f-o,-c),p.strokeStyle="#555",p.lineWidth=o,p.stroke(),{paint:function(n){n.drawImage(h,0,s)}}}function t(n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var e=a.getContext("2d");return{c:e,canvas:a,clear:function(){e.fillStyle="rgba(0, 0, 0, 0.3)",e.fillRect(0,0,n,t)}}}function a(n,t){function a(n,t){var a=r[n];if(a){var i=a[t];i&&!d[i.id]&&(d[i.id]=i,i.shape.isBomb&&e(i))}}function e(n){var t=n.colNumber,e=n.rowNumber;a(t-2,e),a(t+2,e),a(t-1,e-1),a(t+1,e-1),a(t-1,e+1),a(t+1,e+1)}var r={};for(var i in n){var o=n[i];r[i]={};for(var c in o){var l=o[c];r[i][l.rowNumber]=l}}for(var d={},i=0;i<t.length;i++){var u=t[i];d[u.id]=u,u.shape.isBomb&&e(u)}return d}function e(n,t){for(var a=6*n,e=24,r=[],i=0;e>i;i++){var o=a*(e-i)/e,c=o+1,l=document.createElement("canvas");l.width=l.height=2*c;var d=l.getContext("2d");d.fillStyle=t,d.translate(c,c),d.arc(0,0,o,0,2*Math.PI),d.fill(),r.push(l)}return r}function r(n,t,a,e){var r,i,o=0,c=a.particleCanvases;a.isBomb?(r=3*e,i=10):(r=2*e,i=5);for(var l=[],d=0;i>d;d++){var u=x(r,r),v=x(r,r);l.push({x:n+u[0],y:t+u[1],dx:v[0],dy:v[1]})}return{id:Math.random(),paint:function(e){o||a.paint(e,n,t);for(var r in l){var i=c[o],d=l[r],u=d.x-i.width/2,v=d.y-i.height/2;e.drawImage(i,u,v)}},tick:function(){for(var n in l){var t=l[n];t.x+=t.dx,t.y+=t.dy}return o++,o==c.length?!0:void 0}}}function i(n){var t={};return{add:function(a,e,i){var o=r(a,e,i,n);t[o.id]=o},paint:function(n){for(var a in t)t[a].paint(n)},tick:function(){for(var n in t)t[n].tick()&&delete t[n]}}}function o(n,t,a){var e=[];for(var r in n){var i=n[r];for(var o in t){var c=t[o],l=c.x-i.x,d=c.y-i.y,u=Math.hypot(l,d);if(a>u){e.push({movingBubble:i,stillBubble:c,distance:u});break}}}return e}function c(n){var t={};return{add:function(a,e,r){var i=l(a,e,r,n);t[i.id]=i},paint:function(n){for(var a in t)t[a].paint(n)},tick:function(){for(var n in t)t[n].tick()&&delete t[n]}}}function l(n,t,a,e){var r=32,i=r,o=1,c=6*(2*Math.random()-1)*e,l=0;return{id:Math.random(),paint:function(e){e.globalAlpha=o,a.paint(e,n,t),e.globalAlpha=1},tick:function(){return n+=c,t+=l,l+=e,c*=.95,i--,i?(o=i/r,void 0):!0}}}function d(n,t,a,e,r,i){var o=2*Math.max(n,t),c=n/2,l=t-a;return{paint:function(n,t,a,r){var d=t-c,u=a-l,v=Math.hypot(d,u),f=d*o/v,s=u*o/v;-i>u/v&&(n.beginPath(),n.moveTo(c,l),n.lineTo(c+f,l+s),n.lineWidth=e,n.lineCap="round",n.strokeStyle=r,n.stroke())}}}function u(n,t,a,e,r){var i=a+", "+e+"%, "+r+"%",o=t.createLinearGradient(0,0,0,n);return o.addColorStop(0,"hsla("+i+", 0)"),o.addColorStop(1,"hsla("+i+", 0.2)"),o}function v(n,t,a){var e=(n-n*a)/2,r=(t-t*a)/2,i=document.createElement("canvas");return i.className="MainCanvas",i.width=n,i.height=t,i.style.transform="scale("+1/a+") translate("+e+"px, "+r+"px)",i}function f(){function a(){var n=dt.get();return m(J,U,Y,n)}function e(){if(Ct){var n=wt-J/2,t=U-Y-xt,a=Math.hypot(n,t),e=n/a,r=-t/a;if(-St>r&&Bt&&Bt.ready){var i=Bt.shape;yt.add(i,e,r),Bt=null,Pt=10,Gt=null,Ct=!1}}}function r(){return!Bt||!Bt.ready||gt.showing||gt.hiding?!0:gt.visible?(gt.hide(),bt.reset(),mt.reset(),!0):void 0}function l(n){wt=n.clientX*g-Nt,xt=n.clientY*g-kt}function u(n){wt=n.clientX*g-Nt,xt=n.clientY*g-kt,Ct=!0}function f(){requestAnimationFrame(function(){var n=Date.now();vt.clear(),It.clearRect(0,0,J,U),st.paint(ft),mt.paint(ft),bt.paint(ft),Ct&&Et.paint(ft,wt,xt,Bt.shape.laserGradient),Bt&&Bt.paint(ft),yt.paint(ft),ht.paint(ft),pt.paint(ft),gt.visible&&gt.paint(ft),It.drawImage(vt.canvas,0,0),K.innerHTML="repaint "+(Date.now()-n),f()})}function s(){for(var n=0;2>n;n++){var t=Date.now();bt.tick(),yt.tick(),ht.tick(),pt.tick(),gt.visible&&gt.tick();for(var e=o(yt.movingBubbles,bt.stillBubbles,X),r=0;r<e.length;r++){var i=e[r],c=i.movingBubble;c.shiftBack(E-i.distance),p(c),yt.remove(c)}Pt?(Pt--,Pt||(Bt=a())):Bt&&Bt.tick(),z.innerHTML="tick "+(Date.now()-t)}}function p(n){bt.add(n),Ot++,Ot===At&&(Ot=0,bt.shift())}var g=devicePixelRatio,b=innerWidth*g,x=innerHeight*g,C=9+Math.floor((b-300)/200),E=Math.floor(b/C),B=E/40,Y=E/2,q=Math.sin(Math.PI/3)*E,F=Y-1*B,X=2*F,J=b-b%E,U=x-x%E,j="MainPanel",z=document.createElement("div"),K=document.createElement("div"),Q=document.createElement("div");Q.className=j+"-debug",Q.appendChild(K),Q.appendChild(z);var V=k(F,B),Z=I(U,F,B),$=S(F,B),_=P(U,F,B),nt=T(F,B),tt=G(U,F,B),at=L(F,B),et=R(U,F,B),rt=O(F,B),it=A(U,F,B),ot=D(F,B),ct=H(U,F,B),lt=W(F,B),dt=w();dt.add(1,Z),dt.add(1,_),dt.add(1,tt),dt.add(1,et),dt.add(1,it),dt.add(1,ct);var ut=w();ut.add(3,V),ut.add(8,Z),ut.add(1,$),ut.add(8,_),ut.add(1,nt),ut.add(8,tt),ut.add(1,at),ut.add(8,et),ut.add(1,rt),ut.add(8,it),ut.add(1,ot),ut.add(8,ct),ut.add(1,lt);var vt=t(J,U),ft=vt.c,st=n(J,U,E,B),ht=i(B),pt=c(B),mt=N(U,E,B),gt=y(J,U,B),bt=M(U,Y,C,E,ut.get,q,ht.add,pt.add,mt.add,function(){var n=mt.get();gt.show(n,Tt),n>Tt&&(Tt=n,localStorage.highScore=Tt)});bt.reset();var wt,xt,yt=h(J,U,Y,X,p,B),Ct=!1,Mt=v(b,x,g),Nt=(b-J)/2,kt=(x-U)/2,It=Mt.getContext("2d");It.translate(Nt,kt);var St=.2,Et=d(J,U,Y,X,It,St),Bt=a(),Pt=0,Tt=parseInt(localStorage.highScore,10);isFinite(Tt)||(Tt=0);var Gt=null,Lt=!1,Rt=document.createElement("div");Rt.className=j,Rt.appendChild(Mt),Rt.appendChild(Q),Rt.addEventListener("mousedown",function(n){if(Lt)Lt=!1;else{if(r())return;Ct||u(n)}}),Rt.addEventListener("touchstart",function(n){if(!r()&&!Ct){var t=n.changedTouches[0];Gt=t.identifier,u(t)}}),Rt.addEventListener("mousemove",function(n){Lt?Lt=!1:l(n)}),Rt.addEventListener("touchmove",function(n){Lt=!0,n.preventDefault();for(var t=n.changedTouches,a=0;a<t.length;a++){var e=t[a];e.identifier===Gt&&l(e)}}),Rt.addEventListener("mouseup",function(n){Lt?Lt=!1:e(n)}),Rt.addEventListener("touchend",function(n){Lt=!0,n.preventDefault();for(var t=n.changedTouches,a=0;a<t.length;a++){var r=t[a];r.identifier===Gt&&e(r)}});var Ot=0,At=7;return addEventListener("keydown",function(n){32==n.keyCode&&s()}),setInterval(s,30),f(),{element:Rt}}function s(n,t,a,e,r,i,o,c){var l=20*c,d=i*l,u=o*l,v={id:Math.random(),shape:r,x:n/2,y:t-a,paint:function(n){r.paint(n,v.x,v.y)},shiftBack:function(t){var e=Math.hypot(i,o);v.x-=i*t/e,v.y-=o*t/e;var r=a-v.x;r>0&&(v.x+=2*r);var c=v.x+a-n;c>0&&(v.x-=2*c)},tick:function(){v.x+=d,v.y+=u;var t=a-v.x;t>0&&(v.x+=2*t,i=-i,d=i*l);var e=v.x+a-n;return e>0&&(v.x-=2*e,i=-i,d=i*l),v.y<=a?(v.y=a,!0):void 0}};return v}function h(n,t,a,e,r,i){function o(n){delete c[n.id]}var c={};return{movingBubbles:c,remove:o,add:function(r,o,l){var d=s(n,t,a,e,r,o,l,i);c[d.id]=d},paint:function(n){for(var t in c)c[t].paint(n)},tick:function(){for(var n in c){var t=c[n];t.tick()&&(r(t),o(t))}}}}function p(n,t){function a(n,t){var a=r[n];if(a){var i=a[t];i&&!u[i.id]&&i.shape.colorName==d.colorName&&e(i)}}function e(n){var t=n.colNumber,e=n.rowNumber;u[n.id]=n,v.push(n),a(t-2,e),a(t+2,e),a(t-1,e-1),a(t+1,e-1),a(t-1,e+1),a(t+1,e+1)}var r={};for(var i in t){var o=t[i];r[i]={};for(var c in o){var l=o[c];r[i][l.rowNumber]=l}}var d=n.shape,u={},v=[];return e(n),v}function m(n,t,a,e){var r=n/2,i=t+a,o=8,c=0,l=2*a/o,d={ready:!1,shape:e,paint:function(n){n.globalAlpha=c/o,e.paint(n,r,i),n.globalAlpha=1},tick:function(){o>c?(c++,i-=l):d.ready=!0}};return d}function g(n){function t(n,t){var e=i[n];if(e){var o=e[t];if(o){var c=o.id;v[c]||(v[c]=!0,delete r[c],a(o))}}}function a(n){var a=n.colNumber,e=n.rowNumber;t(a-1,e-1),t(a+1,e-1),t(a-2,e),t(a+2,e),t(a-1,e+1),t(a+1,e+1)}var e=[],r={},i={};for(var o in n){var c=n[o];i[o]={};for(var l in c){var d=c[l],u=d.rowNumber;u?(i[o][u]=d,r[d.id]=d):e.push(d)}}for(var v={},o=0;o<e.length;o++)a(e[o]);return r}function b(n,t){for(var a=6*n,e=16,r=[],i=0;e>i;i++){var o=a*(e-i)/e,c=o+1,l=document.createElement("canvas");l.width=l.height=2*c;var d=l.getContext("2d");d.fillStyle=t,d.translate(c,c),d.arc(0,0,o,0,2*Math.PI),d.fill(),r.push(l)}return r}function w(){var n=[],t=0;return{add:function(a,e){n.push({chance:a,shape:e}),t+=a},get:function(){var a=Math.random()*t;for(var e in n){var r=n[e];if(a-=r.chance,0>a)return r.shape}}}}function x(n,t){var a=Math.random()*Math.PI*2,e=n+Math.random()*t,r=Math.cos(a)*e,i=Math.sin(a)*e;return[r,i]}function y(n,t,a){function e(){c&&c--,c||(f.visible=!1,f.hiding=!1),d=c/l}function r(){l>c?c++:f.showing=!1,d=c/l}var i,o,c=0,l=24,d=0,u=26*a,v="bold "+u+"px Arial, sans-serif",f={tick:r,hiding:!1,showing:!1,visible:!1,hide:function(){f.showing=!1,f.tick=e,f.hiding=!0},paint:function(a){var e=Math.pow(d,.25);a.fillStyle="rgba(0, 0, 0, "+.7*e+")",a.fillRect(0,0,n,t);var r=n/2,c=t/4+t*e/4-1.5*u;a.translate(r,c),a.fillStyle="rgba(255, 255, 255, "+e+")",a.textAlign="center",a.textBaseline="top",a.font=v,a.fillText("YOUR SCORE: "+i,0,0),i>o?a.fillText("NEW RECORD!",0,2*u):a.fillText("HIGH SCORE: "+o,0,2*u),a.translate(-r,-c)},show:function(n,t){i=n,o=t,f.visible=!0,f.hiding=!1,f.tick=r,f.showing=!0}};return f}function C(n,t,a,e,r){var i={colNumber:r,id:Math.random(),rowNumber:e,shape:a,x:n,y:t,paint:function(t){a.paint(t,n,i.y)}};return i}function M(n,t,e,r,i,o,c,l,d,u){function v(n){var t=n.id;N[t]=n,I[n.colNumber][t]=n,f(n)}function f(n){!T.gameOver&&n.rowNumber>=E&&(T.gameOver=!0,u())}function s(n,a){for(var e=t+n*t,c=t-o-y,l=0;a>l;l++){var d=i(),u=C(e,c,d,0,n);v(u),h(u,w+M),e+=r,n+=2}}function h(n,t){var a=n.id;k[a]?k[a].steps+=t:k[a]={steps:t,bubble:n}}function m(n){var t=n.id;delete N[t],delete I[n.colNumber][t]}function b(){for(var n in N){var t=N[n];h(t,w),t.rowNumber++,f(t)}B?s(1,e-1):s(0,e),B=!B,y+=o,M+=w}for(var w=4,x=o/w,y=0,M=0,N={},k={},I={},S=0;2*e-1>S;S++)I[S]={};var E=Math.floor((n-r)/o),B=!1,P=3,T={gameOver:!1,shift:b,stillBubbles:N,add:function(n){var e=n.y,i=M*x-t,u=Math.round((e+i)/o);e=u*o-i;var f=(u+(B?1:0))%2?t:0,s=n.x;s=Math.round((s-f)/r)*r+f;var b=Math.floor(s/t)-1,w=C(s,e,n.shape,u,b);v(w),M&&h(w,M);var y=p(w,I);if(y.length>=P){var N=a(I,y),k=0;for(var S in N){var E=N[S];m(E),c(E.x,E.y,E.shape),k++}d(k-P+1);var T=g(I);for(var S in T){var G=T[S];m(G),l(G.x,G.y,G.shape)}}},isOdd:function(){return B},paint:function(n){for(var t in N)N[t].paint(n)},reset:function(){T.gameOver=!1,k={};for(var n in N)delete N[n];for(var n in I){var t=I[n];for(var n in t)delete t[n]}b(),b(),b()},tick:function(){for(var n in k){var t=k[n];t.steps--,t.bubble.y+=x,t.steps||(delete k[n],n--)}M&&(M--,y-=x)}};return T}function N(n,t,a){var e=0,r=10*a,i=n-t+10*a,o="bold "+26*a+"px Arial, sans-serif";return{add:function(n){e+=n},get:function(){return e},paint:function(n){n.textBaseline="top",n.font=o,n.fillStyle="#777",n.fillText(e,r,i)},reset:function(){e=0}}}function k(n,t){var a="hsl(0, 0%, 40%)",e=n+2,r=B(a,"hsl(0, 0%, 15%)",n);return{color:a,colorName:"black",particleCanvases:b(t,a),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function I(n,t,a){var e="hsl(220, 100%, 70%)",r=t+2,i=B(e,"hsl(220, 100%, 55%)",t),o=i.getContext("2d");return{color:e,colorName:"blue",laserGradient:u(n,o,220,100,70),particleCanvases:b(a,e),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function S(n,t){var a="hsl(220, 100%, 70%)",r=n+2,i=B(a,"hsl(220, 100%, 55%)",n);return E(i,n),{color:a,colorName:"blue",isBomb:!0,particleCanvases:e(t,a),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function E(n,t){var a=n.getContext("2d"),e="rgba(255 ,255, 255, 0.4)";a.beginPath(),a.arc(0,0,.25*t,0,2*Math.PI),a.fillStyle=e,a.fill();var r=3,i=2*Math.PI/r,o=.62*t,c=Math.PI/3;a.lineWidth=.45*t,a.beginPath(),a.rotate(Math.PI/2-c/2);for(var l=0;r>l;l++)a.moveTo(o,0),a.arc(0,0,o,0,c),a.rotate(i);a.strokeStyle=e,a.stroke()}function B(n,t,a){var e=a+2,r=document.createElement("canvas");r.width=r.height=2*e;var i=r.getContext("2d"),o=-a/2,c=i.createRadialGradient(0,o,0,0,o,2*a);return c.addColorStop(0,n),c.addColorStop(.5,t),c.addColorStop(1,n),i.fillStyle=c,i.translate(e,e),i.arc(0,0,a,0,2*Math.PI),i.fillStyle=c,i.fill(),r}function P(n,t,a){var e="hsl(100, 100%, 40%)",r=t+2,i=B(e,"hsl(100, 100%, 30%)",t),o=i.getContext("2d");return{color:e,colorName:"green",laserGradient:u(n,o,100,100,40),particleCanvases:b(a,e),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function T(n,t){var a="hsl(100, 100%, 40%)",r=n+2,i=B(a,"hsl(100, 100%, 30%)",n);return E(i,n),{color:a,colorName:"green",isBomb:!0,particleCanvases:e(t,a),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function G(n,t,a){var e="hsl(5, 100%, 65%)",r=t+2,i=B(e,"hsl(5, 100%, 40%)",t),o=i.getContext("2d");return{color:e,colorName:"red",laserGradient:u(n,o,5,100,65),particleCanvases:b(a,e),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function L(n,t){var a="hsl(5, 100%, 65%)",r=n+2,i=B(a,"hsl(5, 100%, 40%)",n);return E(i,n),{color:a,colorName:"red",isBomb:!0,particleCanvases:e(t,a),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function R(n,t,a){var e="hsl(300, 100%, 60%)",r=t+2,i=B(e,"hsl(300, 100%, 40%)",t),o=i.getContext("2d");return{color:e,colorName:"violet",laserGradient:u(n,o,300,100,60),particleCanvases:b(a,e),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function O(n,t){var a="hsl(300, 100%, 60%)",r=n+2,i=B(a,"hsl(300, 100%, 40%)",n);return E(i,n),{color:a,colorName:"violet",isBomb:!0,particleCanvases:e(t,a),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function A(n,t,a){var e="hsl(0, 0%, 90%)",r=t+2,i=B(e,"hsl(0, 0%, 70%)",t),o=i.getContext("2d");return{color:e,colorName:"white",laserGradient:u(n,o,0,0,90),particleCanvases:b(a,e),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function D(n,t){var a="hsl(0, 0%, 90%)",r=n+2,i=B(a,"hsl(0, 0%, 70%)",n);return E(i,n),{color:a,colorName:"white",isBomb:!0,particleCanvases:e(t,a),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function H(n,t,a){var e="hsl(60, 90%, 70%)",r=t+2,i=B(e,"hsl(60, 90%, 40%)",t),o=i.getContext("2d");return{color:e,colorName:"yellow",laserGradient:u(n,o,60,90,70),particleCanvases:b(a,e),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}function W(n,t){var a="hsl(60, 90%, 70%)",r=n+2,i=B(a,"hsl(60, 90%, 40%)",n);return E(i,n),{color:a,colorName:"yellow",isBomb:!0,particleCanvases:e(t,a),paint:function(n,t,a){n.drawImage(i,t-r,a-r)}}}!function(){var n=f();document.body.appendChild(n.element)}()}();
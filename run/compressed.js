!function(){function n(n,t,a,e){var r=a/2,i=8*e,o=4*e,c=r-o/2,d=r+i,l=Math.asin(c/d),u=Math.sqrt(1-Math.pow(c/d,2))*d,f=a+i+o,v=n/2,h=t-f,s=document.createElement("canvas");s.width=n,s.height=f;var p=s.getContext("2d");return p.lineJoin=p.lineCap="round",p.translate(v,f-r),p.moveTo(-v+o,-c),p.lineTo(-u,-c),p.arc(0,0,d,-Math.PI+l,-l),p.lineTo(v-o,-c),p.strokeStyle="#555",p.lineWidth=o,p.stroke(),{paint:function(n){n.drawImage(s,0,h)}}}function t(n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var e=a.getContext("2d");return{c:e,canvas:a,clear:function(){e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(0,0,n,t)}}}function a(n,t,a,e){for(var r=16,i=r,o=2*Math.PI,c=2*e,d=[],l=0;6>l;l++){var u=m(c,c),f=m(c,c);d.push({x:n+u[0],y:t+u[1],dx:f[0],dy:f[1]})}return{id:Math.random(),paint:function(c){i==r&&a.paint(c,n,t);for(var l in d){var u=d[l],f=u.x,v=u.y;c.beginPath(),c.moveTo(f,v),c.fillStyle=a.color,c.arc(f,v,4*i/r*e,0,o),c.fill()}},tick:function(){for(var n in d){var t=d[n];t.x+=t.dx,t.y+=t.dy}return i--,i?void 0:!0}}}function e(n){var t={};return{add:function(e,r,i){var o=a(e,r,i,n);t[o.id]=o},paint:function(n){for(var a in t)t[a].paint(n)},tick:function(){for(var n in t)t[n].tick()&&delete t[n]}}}function r(n,t,a){var e=[];for(var r in n){var i=n[r];for(var o in t){var c=t[o],d=c.x-i.x,l=c.y-i.y,u=Math.hypot(d,l);if(a>u){e.push({movingBubble:i,stillBubble:c,distance:u});break}}}return e}function i(n){var t={};return{add:function(a,e,r){var i=o(a,e,r,n);t[i.id]=i},paint:function(n){for(var a in t)t[a].paint(n)},tick:function(){for(var n in t)t[n].tick()&&delete t[n]}}}function o(n,t,a,e){var r=32,i=r,o=1,c=6*(2*Math.random()-1)*e,d=0;return{id:Math.random(),paint:function(e){e.globalAlpha=o,a.paint(e,n,t),e.globalAlpha=1},tick:function(){return n+=c,t+=d,d+=e,c*=.95,i--,i?void(o=i/r):!0}}}function c(n,t,a,e,r,i){var o=2*Math.max(n,t),c=n/2,d=t-a;return{paint:function(n,t,a,r){var l=t-c,u=a-d,f=Math.hypot(l,u),v=l*o/f,h=u*o/f;-i>u/f&&(n.beginPath(),n.moveTo(c,d),n.lineTo(c+v,d+h),n.lineWidth=e,n.lineCap="round",n.strokeStyle=r,n.stroke())}}}function d(n,t,a,e,r){var i=a+", "+e+"%, "+r+"%",o=t.createLinearGradient(0,0,0,n);return o.addColorStop(0,"hsla("+i+", 0)"),o.addColorStop(1,"hsla("+i+", 0.2)"),o}function l(n,t,a){var e=(n-n*a)/2,r=(t-t*a)/2,i=document.createElement("canvas");return i.className="MainCanvas",i.width=n,i.height=t,i.style.transform="scale("+1/a+") translate("+e+"px, "+r+"px)",i}function u(){function a(){var n=U.get();return s(L,D,x,n)}function o(){requestAnimationFrame(function(){var n=Date.now();z.clear(),lt.clearRect(0,0,L,D),Q.paint(K),_.paint(K),tt.paint(K),it&&vt.paint(K,at,et,ht.shape.laserGradient),ht&&ht.paint(K),rt.paint(K),Z.paint(K),$.paint(K),nt.visible&&nt.paint(K),lt.drawImage(z.canvas,0,0),P.innerHTML="repaint "+(Date.now()-n),o()})}function d(){var n=Date.now();tt.tick(),rt.tick(),Z.tick(),$.tick(),nt.visible&&nt.tick(),ht&&ht.tick();for(var t=r(rt.movingBubbles,tt.stillBubbles,G),a=0;a<t.length;a++){var e=t[a],i=e.movingBubble;i.shiftBack(m-e.distance),u(i),rt.remove(i)}O.innerHTML="tick "+(Date.now()-n)}function u(n){tt.add(n),mt++,mt===bt&&(mt=0,tt.shift())}var f=devicePixelRatio,h=innerWidth*f,p=innerHeight*f,m=40*f,x=m/2,C=Math.sin(Math.PI/3)*m,B=x-1*f,G=2*B,R="MainPanel",O=document.createElement("div"),P=document.createElement("div"),A=document.createElement("div");A.className=R+"-debug",A.appendChild(P),A.appendChild(O);var L=h-h%m,D=p-p%m,H=M(B),W=k(D,B),Y=S(D,B),q=I(D,B),F=T(D,B),X=E(D,B),J=N(D,B),U=g();U.add(1,W),U.add(1,Y),U.add(1,q),U.add(1,F),U.add(1,X),U.add(1,J);var j=g();j.add(2,H),j.add(5,W),j.add(5,Y),j.add(5,q),j.add(5,F),j.add(5,X),j.add(5,J);var z=t(L,D),K=z.c,Q=n(L,D,m,f),V=Math.floor(h/m),Z=e(f),$=i(f),_=w(D,m,f),nt=b(L,D,f),tt=y(D,x,V,m,j.get,C,Z.add,$.add,_.add,function(){var n=_.get();nt.show(n,st),n>st&&(st=n,localStorage.highScore=st)});tt.reset();var at,et,rt=v(L,D,x,G,u,f),it=!1,ot=l(h,p,f),ct=(h-L)/2,dt=(p-D)/2,lt=ot.getContext("2d");lt.translate(ct,dt);var ut,ft=.2,vt=c(L,D,x,G,lt,ft),ht=a(),st=parseInt(localStorage.highScore,10);isFinite(st)||(st=0);var pt=null,gt=document.createElement("div");gt.className=R,gt.appendChild(ot),gt.appendChild(A),gt.addEventListener("touchstart",function(n){if(ht&&ht.ready&&!nt.showing&&!nt.hiding){if(nt.visible)return nt.hide(),tt.reset(),void _.reset();if(null===pt){var t=n.changedTouches[0];at=t.clientX*f-ct,et=t.clientY*f-dt,pt=t.identifier,it=!0}}}),gt.addEventListener("touchmove",function(n){for(var t=n.changedTouches,a=0;a<t.length;a++){var e=t[a];e.identifier===pt&&(at=e.clientX*f-ct,et=e.clientY*f-dt)}}),gt.addEventListener("touchend",function(n){for(var t=n.changedTouches,e=0;e<t.length;e++){var r=t[e];if(r.identifier===pt){it=!1;var r=n.changedTouches[0],i=at-L/2,o=D-x-et,c=Math.hypot(i,o),d=i/c,l=-o/c;if(-ft>l){var u=ht.shape;rt.add(u,d,l),ht=null,ut=setTimeout(function(){ht=a()},200),pt=null}}}});var mt=0,bt=7;return addEventListener("keydown",function(n){32==n.keyCode&&d()}),setInterval(d,20),o(),{element:gt}}function f(n,t,a,e,r,i,o,c){var d=20*c,l=i*d,u=o*d,f={id:Math.random(),shape:r,x:n/2,y:t-a,paint:function(n){r.paint(n,f.x,f.y)},shiftBack:function(t){var e=Math.hypot(i,o);f.x-=i*t/e,f.y-=o*t/e;var r=a-f.x;r>0&&(f.x+=2*r);var c=f.x+a-n;c>0&&(f.x-=2*c)},tick:function(){f.x+=l,f.y+=u;var t=a-f.x;t>0&&(f.x+=2*t,i=-i,l=i*d);var e=f.x+a-n;return e>0&&(f.x-=2*e,i=-i,l=i*d),f.y<=a?(f.y=a,!0):void 0}};return f}function v(n,t,a,e,r,i){function o(n){delete c[n.id]}var c={};return{movingBubbles:c,remove:o,add:function(r,o,d){var l=f(n,t,a,e,r,o,d,i);c[l.id]=l},paint:function(n){for(var t in c)c[t].paint(n)},tick:function(){for(var n in c){var t=c[n];t.tick()&&(r(t),o(t))}}}}function h(n,t){function a(n,t){var a=r[n];if(a){var i=a[t];i&&!u[i.id]&&i.shape==l&&e(i)}}function e(n){var t=n.colNumber,e=n.rowNumber;u[n.id]=n,f.push(n),a(t-2,e),a(t+2,e),a(t-1,e-1),a(t+1,e-1),a(t-1,e+1),a(t+1,e+1)}var r={};for(var i in t){var o=t[i];r[i]={};for(var c in o){var d=o[c];r[i][d.rowNumber]=d}}var l=n.shape,u={},f=[];return e(n),f}function s(n,t,a,e){var r=n/2,i=t+a,o=8,c=0,d=2*a/o,l={ready:!1,shape:e,paint:function(n){n.globalAlpha=c/o,e.paint(n,r,i),n.globalAlpha=1},tick:function(){o>c?(c++,i-=d):l.ready=!0}};return l}function p(n){function t(n,t){var e=i[n];if(e){var o=e[t];if(o){var c=o.id;f[c]||(f[c]=!0,delete r[c],a(o))}}}function a(n){var a=n.colNumber,e=n.rowNumber;t(a-1,e-1),t(a+1,e-1),t(a-2,e),t(a+2,e),t(a-1,e+1),t(a+1,e+1)}var e=[],r={},i={};for(var o in n){var c=n[o];i[o]={};for(var d in c){var l=c[d],u=l.rowNumber;u?(i[o][u]=l,r[l.id]=l):e.push(l)}}for(var f={},o=0;o<e.length;o++)a(e[o]);return r}function g(){var n=[],t=0;return{add:function(a,e){n.push({chance:a,shape:e}),t+=a},get:function(){var a=Math.random()*t;for(var e in n){var r=n[e];if(a-=r.chance,0>a)return r.shape}}}}function m(n,t){var a=Math.random()*Math.PI*2,e=n+Math.random()*t,r=Math.cos(a)*e,i=Math.sin(a)*e;return[r,i]}function b(n,t,a){function e(){c&&c--,c||(v.visible=!1,v.hiding=!1),l=c/d}function r(){d>c?c++:v.showing=!1,l=c/d}var i,o,c=0,d=24,l=0,u=26*a,f="bold "+u+"px Arial, sans-serif",v={tick:r,hiding:!1,showing:!1,visible:!1,hide:function(){v.showing=!1,v.tick=e,v.hiding=!0},paint:function(a){var e=Math.pow(l,.25);a.fillStyle="rgba(0, 0, 0, "+.7*e+")",a.fillRect(0,0,n,t);var r=n/2,c=t/4+t*e/4-1.5*u;a.translate(r,c),a.fillStyle="rgba(255, 255, 255, "+e+")",a.textAlign="center",a.textBaseline="top",a.font=f,a.fillText("YOUR SCORE: "+i,0,0),i>o?a.fillText("NEW RECORD!",0,2*u):a.fillText("HIGH SCORE: "+o,0,2*u),a.translate(-r,-c)},show:function(n,t){i=n,o=t,v.visible=!0,v.hiding=!1,v.tick=r,v.showing=!0}};return v}function x(n,t,a,e,r){var i={colNumber:r,id:Math.random(),rowNumber:e,shape:a,x:n,y:t,paint:function(t){a.paint(t,n,i.y)}};return i}function y(n,t,a,e,r,i,o,c,d,l){function u(n){var t=n.id;k[t]=n,S[n.colNumber][t]=n,f(n)}function f(n){!B.gameOver&&n.rowNumber>=T&&(B.gameOver=!0,l())}function v(n,a){for(var o=t+n*t,c=t-i-w,d=0;a>d;d++){var l=r(),f=x(o,c,l,0,n);u(f),s(f,b+M),o+=e,n+=2}}function s(n,t){var a=n.id;C[a]?C[a].steps+=t:C[a]={steps:t,bubble:n}}function g(n){var t=n.id;delete k[t],delete S[n.colNumber][t]}function m(){for(var n in k){var t=k[n];s(t,b),t.rowNumber++,f(t)}E?v(1,a-1):v(0,a),E=!E,w+=i,M+=b}for(var b=4,y=i/b,w=0,M=0,k={},C={},S={},I=0;2*a-1>I;I++)S[I]={};var T=Math.floor((n-e)/i),E=!1,N=3,B={gameOver:!1,shift:m,stillBubbles:k,add:function(n){var a=n.y,r=M*y-t,l=Math.round((a+r)/i);a=l*i-r;var f=(l+(E?1:0))%2?t:0,v=n.x;v=Math.round((v-f)/e)*e+f;var m=Math.floor(v/t)-1,b=x(v,a,n.shape,l,m);u(b),M&&s(b,M);var w=h(b,S);if(w.length>=N){d(w.length-N+1);for(var k=0;k<w.length;k++){var C=w[k];g(C),o(C.x,C.y,C.shape)}var I=p(S);for(var k in I){var T=I[k];g(T),c(T.x,T.y,T.shape)}}},isOdd:function(){return E},paint:function(n){for(var t in k)k[t].paint(n)},reset:function(){B.gameOver=!1,C={};for(var n in k)delete k[n];for(var n in S){var t=S[n];for(var n in t)delete t[n]}m(),m(),m()},tick:function(){for(var n in C){var t=C[n];t.steps--,t.bubble.y+=y,t.steps||(delete C[n],n--)}M&&(M--,w-=y)}};return B}function w(n,t,a){var e=0,r=10*a,i=n-t+10*a,o="bold "+26*a+"px Arial, sans-serif";return{add:function(n){e+=n},get:function(){return e},paint:function(n){n.textBaseline="top",n.font=o,n.fillStyle="#777",n.fillText(e,r,i)},reset:function(){e=0}}}function M(n){var t="hsl(0, 0%, 40%)",a=n+2,e=C(t,"hsl(0, 0%, 15%)",n);return{color:t,paint:function(n,t,r){n.drawImage(e,t-a,r-a)}}}function k(n,t){var a="hsl(220, 100%, 70%)",e=t+2,r=C(a,"hsl(220, 100%, 55%)",t),i=r.getContext("2d");return{color:a,laserGradient:d(n,i,220,100,70),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function C(n,t,a){var e=a+2,r=document.createElement("canvas");r.width=r.height=2*e;var i=r.getContext("2d"),o=-a/2,c=i.createRadialGradient(0,o,0,0,o,2*a);return c.addColorStop(0,n),c.addColorStop(.5,t),c.addColorStop(1,n),i.fillStyle=c,i.translate(e,e),i.arc(0,0,a,0,2*Math.PI),i.fillStyle=c,i.fill(),r}function S(n,t){var a="hsl(100, 100%, 40%)",e=t+2,r=C(a,"hsl(100, 100%, 30%)",t),i=r.getContext("2d");return{color:a,laserGradient:d(n,i,100,100,40),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function I(n,t){var a="hsl(5, 100%, 65%)",e=t+2,r=C(a,"hsl(5, 100%, 40%)",t),i=r.getContext("2d");return{color:a,laserGradient:d(n,i,5,100,65),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function T(n,t){var a="hsl(300, 100%, 60%)",e=t+2,r=C(a,"hsl(300, 100%, 40%)",t),i=r.getContext("2d");return{color:a,laserGradient:d(n,i,300,100,60),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function E(n,t){var a="hsl(0, 0%, 90%)",e=t+2,r=C(a,"hsl(0, 0%, 70%)",t),i=r.getContext("2d");return{color:a,laserGradient:d(n,i,0,0,90),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function N(n,t){var a="hsl(60, 90%, 70%)",e=t+2,r=C(a,"hsl(60, 90%, 40%)",t),i=r.getContext("2d");return{color:a,laserGradient:d(n,i,60,90,70),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}!function(){var n=u();document.body.appendChild(n.element)}()}();
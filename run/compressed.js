!function(){function n(n,t,a,r){var e=a/2,i=8*r,o=4*r,c=e-o/2,l=e+i,u=Math.asin(c/l),d=Math.sqrt(1-Math.pow(c/l,2))*l,f=a+i+o,v=n/2,s=t-f,h=document.createElement("canvas");h.width=n,h.height=f;var m=h.getContext("2d");return m.lineJoin=m.lineCap="round",m.translate(v,f-e),m.moveTo(-v+o,-c),m.lineTo(-d,-c),m.arc(0,0,l,-Math.PI+u,-u),m.lineTo(v-o,-c),m.strokeStyle="#555",m.lineWidth=o,m.stroke(),{paint:function(n){n.drawImage(h,0,s)}}}function t(n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var r=a.getContext("2d");return{c:r,canvas:a,clear:function(){r.fillStyle="rgba(0, 0, 0, 0.4)",r.fillRect(0,0,n,t)}}}function a(n,t){function a(n,t){var a=e[n];if(a){var i=a[t];i&&!u[i.id]&&(u[i.id]=i,i.shape.isBomb&&r(i))}}function r(n){var t=n.colNumber,r=n.rowNumber;a(t-2,r),a(t+2,r),a(t-1,r-1),a(t+1,r-1),a(t-1,r+1),a(t+1,r+1)}var e={};for(var i in n){var o=n[i];e[i]={};for(var c in o){var l=o[c];e[i][l.rowNumber]=l}}for(var u={},i=0;i<t.length;i++){var d=t[i];u[d.id]=d,d.shape.isBomb&&r(d)}return u}function r(n,t,a,r){for(var e=16,i=e,o=2*Math.PI,c=2*r,l=[],u=0;6>u;u++){var d=b(c,c),f=b(c,c);l.push({x:n+d[0],y:t+d[1],dx:f[0],dy:f[1]})}return{id:Math.random(),paint:function(c){i==e&&a.paint(c,n,t);for(var u in l){var d=l[u],f=d.x,v=d.y;c.beginPath(),c.moveTo(f,v),c.fillStyle=a.color,c.arc(f,v,4*i/e*r,0,o),c.fill()}},tick:function(){for(var n in l){var t=l[n];t.x+=t.dx,t.y+=t.dy}return i--,i?void 0:!0}}}function e(n){var t={};return{add:function(a,e,i){var o=r(a,e,i,n);t[o.id]=o},paint:function(n){for(var a in t)t[a].paint(n)},tick:function(){for(var n in t)t[n].tick()&&delete t[n]}}}function i(n,t,a){var r=[];for(var e in n){var i=n[e];for(var o in t){var c=t[o],l=c.x-i.x,u=c.y-i.y,d=Math.hypot(l,u);if(a>d){r.push({movingBubble:i,stillBubble:c,distance:d});break}}}return r}function o(n){var t={};return{add:function(a,r,e){var i=c(a,r,e,n);t[i.id]=i},paint:function(n){for(var a in t)t[a].paint(n)},tick:function(){for(var n in t)t[n].tick()&&delete t[n]}}}function c(n,t,a,r){var e=32,i=e,o=1,c=6*(2*Math.random()-1)*r,l=0;return{id:Math.random(),paint:function(r){r.globalAlpha=o,a.paint(r,n,t),r.globalAlpha=1},tick:function(){return n+=c,t+=l,l+=r,c*=.95,i--,i?(o=i/e,void 0):!0}}}function l(n,t,a,r,e,i){var o=2*Math.max(n,t),c=n/2,l=t-a;return{paint:function(n,t,a,e){var u=t-c,d=a-l,f=Math.hypot(u,d),v=u*o/f,s=d*o/f;-i>d/f&&(n.beginPath(),n.moveTo(c,l),n.lineTo(c+v,l+s),n.lineWidth=r,n.lineCap="round",n.strokeStyle=e,n.stroke())}}}function u(n,t,a,r,e){var i=a+", "+r+"%, "+e+"%",o=t.createLinearGradient(0,0,0,n);return o.addColorStop(0,"hsla("+i+", 0)"),o.addColorStop(1,"hsla("+i+", 0.2)"),o}function d(n,t,a){var r=(n-n*a)/2,e=(t-t*a)/2,i=document.createElement("canvas");return i.className="MainCanvas",i.width=n,i.height=t,i.style.transform="scale("+1/a+") translate("+r+"px, "+e+"px)",i}function f(){function a(){var n=ct.get();return m(j,z,H,n)}function r(){var n=bt-j/2,t=z-H-wt,r=Math.hypot(n,t),e=n/r,i=-t/r;if(-St>i&&Et){var o=Et.shape;xt.add(o,e,i),Et=null,It=setTimeout(function(){Et=a()},200),Pt=null,yt=!1}}function c(){return!Et||!Et.ready||pt.showing||pt.hiding?!0:pt.visible?(pt.hide(),gt.reset(),mt.reset(),!0):void 0}function u(n){bt=n.clientX*b-Nt,wt=n.clientY*b-kt}function f(n){bt=n.clientX*b-Nt,wt=n.clientY*b-kt,yt=!0}function v(){requestAnimationFrame(function(){var n=Date.now();ut.clear(),Ct.clearRect(0,0,j,z),ft.paint(dt),mt.paint(dt),gt.paint(dt),yt&&Bt.paint(dt,bt,wt,Et.shape.laserGradient),Et&&Et.paint(dt),xt.paint(dt),st.paint(dt),ht.paint(dt),pt.visible&&pt.paint(dt),Ct.drawImage(ut.canvas,0,0),J.innerHTML="repaint "+(Date.now()-n),v()})}function h(){var n=Date.now();gt.tick(),xt.tick(),st.tick(),ht.tick(),pt.visible&&pt.tick(),Et&&Et.tick();for(var t=i(xt.movingBubbles,gt.stillBubbles,q),a=0;a<t.length;a++){var r=t[a],e=r.movingBubble;e.shiftBack(S-r.distance),p(e),xt.remove(e)}X.innerHTML="tick "+(Date.now()-n)}function p(n){gt.add(n),Rt++,Rt===Ot&&(Rt=0,gt.shift())}var b=devicePixelRatio,x=innerWidth*b,I=innerHeight*b,S=40*b,H=S/2,W=Math.sin(Math.PI/3)*S,Y=H-1*b,q=2*Y,F="MainPanel",X=document.createElement("div"),J=document.createElement("div"),U=document.createElement("div");U.className=F+"-debug",U.appendChild(J),U.appendChild(X);var j=x-x%S,z=I-I%S,K=N(Y),Q=k(z,Y),V=C(Y),Z=B(z,Y),$=E(Y),_=T(z,Y),nt=P(Y),tt=G(z,Y),at=L(Y),rt=R(z,Y),et=O(Y),it=A(z,Y),ot=D(Y),ct=g();ct.add(1,Q),ct.add(1,Z),ct.add(1,_),ct.add(1,tt),ct.add(1,rt),ct.add(1,it);var lt=g();lt.add(3,K),lt.add(8,Q),lt.add(1,V),lt.add(8,Z),lt.add(1,$),lt.add(8,_),lt.add(1,nt),lt.add(8,tt),lt.add(1,at),lt.add(8,rt),lt.add(1,et),lt.add(8,it),lt.add(1,ot);var ut=t(j,z),dt=ut.c,ft=n(j,z,S,b),vt=Math.floor(x/S),st=e(b),ht=o(b),mt=M(z,S,b),pt=w(j,z,b),gt=y(z,H,vt,S,lt.get,W,st.add,ht.add,mt.add,function(){var n=mt.get();pt.show(n,Tt),n>Tt&&(Tt=n,localStorage.highScore=Tt)});gt.reset();var bt,wt,xt=s(j,z,H,q,p,b),yt=!1,Mt=d(x,I,b),Nt=(x-j)/2,kt=(I-z)/2,Ct=Mt.getContext("2d");Ct.translate(Nt,kt);var It,St=.2,Bt=l(j,z,H,q,Ct,St),Et=a(),Tt=parseInt(localStorage.highScore,10);isFinite(Tt)||(Tt=0);var Pt=null,Gt=!1,Lt=document.createElement("div");Lt.className=F,Lt.appendChild(Mt),Lt.appendChild(U),Lt.addEventListener("mousedown",function(n){if(Gt)Gt=!1;else{if(c())return;yt||f(n)}}),Lt.addEventListener("touchstart",function(n){if(!c()&&!yt){var t=n.changedTouches[0];Pt=t.identifier,f(t)}}),Lt.addEventListener("mousemove",function(n){Gt?Gt=!1:u(n)}),Lt.addEventListener("touchmove",function(n){Gt=!0,n.preventDefault();for(var t=n.changedTouches,a=0;a<t.length;a++){var r=t[a];r.identifier===Pt&&u(r)}}),Lt.addEventListener("mouseup",function(n){Gt?Gt=!1:r(n)}),Lt.addEventListener("touchend",function(n){Gt=!0,n.preventDefault();for(var t=n.changedTouches,a=0;a<t.length;a++){var e=t[a];e.identifier===Pt&&r(e)}});var Rt=0,Ot=7;return addEventListener("keydown",function(n){32==n.keyCode&&h()}),setInterval(h,20),v(),{element:Lt}}function v(n,t,a,r,e,i,o,c){var l=20*c,u=i*l,d=o*l,f={id:Math.random(),shape:e,x:n/2,y:t-a,paint:function(n){e.paint(n,f.x,f.y)},shiftBack:function(t){var r=Math.hypot(i,o);f.x-=i*t/r,f.y-=o*t/r;var e=a-f.x;e>0&&(f.x+=2*e);var c=f.x+a-n;c>0&&(f.x-=2*c)},tick:function(){f.x+=u,f.y+=d;var t=a-f.x;t>0&&(f.x+=2*t,i=-i,u=i*l);var r=f.x+a-n;return r>0&&(f.x-=2*r,i=-i,u=i*l),f.y<=a?(f.y=a,!0):void 0}};return f}function s(n,t,a,r,e,i){function o(n){delete c[n.id]}var c={};return{movingBubbles:c,remove:o,add:function(e,o,l){var u=v(n,t,a,r,e,o,l,i);c[u.id]=u},paint:function(n){for(var t in c)c[t].paint(n)},tick:function(){for(var n in c){var t=c[n];t.tick()&&(e(t),o(t))}}}}function h(n,t){function a(n,t){var a=e[n];if(a){var i=a[t];i&&!d[i.id]&&i.shape.colorName==u.colorName&&r(i)}}function r(n){var t=n.colNumber,r=n.rowNumber;d[n.id]=n,f.push(n),a(t-2,r),a(t+2,r),a(t-1,r-1),a(t+1,r-1),a(t-1,r+1),a(t+1,r+1)}var e={};for(var i in t){var o=t[i];e[i]={};for(var c in o){var l=o[c];e[i][l.rowNumber]=l}}var u=n.shape,d={},f=[];return r(n),f}function m(n,t,a,r){var e=n/2,i=t+a,o=8,c=0,l=2*a/o,u={ready:!1,shape:r,paint:function(n){n.globalAlpha=c/o,r.paint(n,e,i),n.globalAlpha=1},tick:function(){o>c?(c++,i-=l):u.ready=!0}};return u}function p(n){function t(n,t){var r=i[n];if(r){var o=r[t];if(o){var c=o.id;f[c]||(f[c]=!0,delete e[c],a(o))}}}function a(n){var a=n.colNumber,r=n.rowNumber;t(a-1,r-1),t(a+1,r-1),t(a-2,r),t(a+2,r),t(a-1,r+1),t(a+1,r+1)}var r=[],e={},i={};for(var o in n){var c=n[o];i[o]={};for(var l in c){var u=c[l],d=u.rowNumber;d?(i[o][d]=u,e[u.id]=u):r.push(u)}}for(var f={},o=0;o<r.length;o++)a(r[o]);return e}function g(){var n=[],t=0;return{add:function(a,r){n.push({chance:a,shape:r}),t+=a},get:function(){var a=Math.random()*t;for(var r in n){var e=n[r];if(a-=e.chance,0>a)return e.shape}}}}function b(n,t){var a=Math.random()*Math.PI*2,r=n+Math.random()*t,e=Math.cos(a)*r,i=Math.sin(a)*r;return[e,i]}function w(n,t,a){function r(){c&&c--,c||(v.visible=!1,v.hiding=!1),u=c/l}function e(){l>c?c++:v.showing=!1,u=c/l}var i,o,c=0,l=24,u=0,d=26*a,f="bold "+d+"px Arial, sans-serif",v={tick:e,hiding:!1,showing:!1,visible:!1,hide:function(){v.showing=!1,v.tick=r,v.hiding=!0},paint:function(a){var r=Math.pow(u,.25);a.fillStyle="rgba(0, 0, 0, "+.7*r+")",a.fillRect(0,0,n,t);var e=n/2,c=t/4+t*r/4-1.5*d;a.translate(e,c),a.fillStyle="rgba(255, 255, 255, "+r+")",a.textAlign="center",a.textBaseline="top",a.font=f,a.fillText("YOUR SCORE: "+i,0,0),i>o?a.fillText("NEW RECORD!",0,2*d):a.fillText("HIGH SCORE: "+o,0,2*d),a.translate(-e,-c)},show:function(n,t){i=n,o=t,v.visible=!0,v.hiding=!1,v.tick=e,v.showing=!0}};return v}function x(n,t,a,r,e){var i={colNumber:e,id:Math.random(),rowNumber:r,shape:a,x:n,y:t,paint:function(t){a.paint(t,n,i.y)}};return i}function y(n,t,r,e,i,o,c,l,u,d){function f(n){var t=n.id;k[t]=n,I[n.colNumber][t]=n,v(n)}function v(n){!P.gameOver&&n.rowNumber>=B&&(P.gameOver=!0,d())}function s(n,a){for(var r=t+n*t,c=t-o-M,l=0;a>l;l++){var u=i(),d=x(r,c,u,0,n);f(d),m(d,w+N),r+=e,n+=2}}function m(n,t){var a=n.id;C[a]?C[a].steps+=t:C[a]={steps:t,bubble:n}}function g(n){var t=n.id;delete k[t],delete I[n.colNumber][t]}function b(){for(var n in k){var t=k[n];m(t,w),t.rowNumber++,v(t)}E?s(1,r-1):s(0,r),E=!E,M+=o,N+=w}for(var w=4,y=o/w,M=0,N=0,k={},C={},I={},S=0;2*r-1>S;S++)I[S]={};var B=Math.floor((n-e)/o),E=!1,T=3,P={gameOver:!1,shift:b,stillBubbles:k,add:function(n){var r=n.y,i=N*y-t,d=Math.round((r+i)/o);r=d*o-i;var v=(d+(E?1:0))%2?t:0,s=n.x;s=Math.round((s-v)/e)*e+v;var b=Math.floor(s/t)-1,w=x(s,r,n.shape,d,b);f(w),N&&m(w,N);var M=h(w,I);if(M.length>=T){var k=a(I,M),C=0;for(var S in k){var B=k[S];g(B),c(B.x,B.y,B.shape),C++}u(C-T+1);var P=p(I);for(var S in P){var G=P[S];g(G),l(G.x,G.y,G.shape)}}},isOdd:function(){return E},paint:function(n){for(var t in k)k[t].paint(n)},reset:function(){P.gameOver=!1,C={};for(var n in k)delete k[n];for(var n in I){var t=I[n];for(var n in t)delete t[n]}b(),b(),b()},tick:function(){for(var n in C){var t=C[n];t.steps--,t.bubble.y+=y,t.steps||(delete C[n],n--)}N&&(N--,M-=y)}};return P}function M(n,t,a){var r=0,e=10*a,i=n-t+10*a,o="bold "+26*a+"px Arial, sans-serif";return{add:function(n){r+=n},get:function(){return r},paint:function(n){n.textBaseline="top",n.font=o,n.fillStyle="#777",n.fillText(r,e,i)},reset:function(){r=0}}}function N(n){var t="hsl(0, 0%, 40%)",a=n+2,r=S(t,"hsl(0, 0%, 15%)",n);return{color:t,colorName:"black",paint:function(n,t,e){n.drawImage(r,t-a,e-a)}}}function k(n,t){var a="hsl(220, 100%, 70%)",r=t+2,e=S(a,"hsl(220, 100%, 55%)",t),i=e.getContext("2d");return{color:a,colorName:"blue",laserGradient:u(n,i,220,100,70),paint:function(n,t,a){n.drawImage(e,t-r,a-r)}}}function C(n){var t="hsl(220, 100%, 70%)",a=n+2,r=S(t,"hsl(220, 100%, 55%)",n);return I(r,n),{color:t,colorName:"blue",isBomb:!0,paint:function(n,t,e){n.drawImage(r,t-a,e-a)}}}function I(n,t){var a=n.getContext("2d"),r="rgba(255 ,255, 255, 0.4)";a.beginPath(),a.arc(0,0,.25*t,0,2*Math.PI),a.fillStyle=r,a.fill();var e=3,i=2*Math.PI/e,o=.62*t,c=Math.PI/3;a.lineWidth=.45*t,a.beginPath(),a.rotate(Math.PI/2-c/2);for(var l=0;e>l;l++)a.moveTo(o,0),a.arc(0,0,o,0,c),a.rotate(i);a.strokeStyle=r,a.stroke()}function S(n,t,a){var r=a+2,e=document.createElement("canvas");e.width=e.height=2*r;var i=e.getContext("2d"),o=-a/2,c=i.createRadialGradient(0,o,0,0,o,2*a);return c.addColorStop(0,n),c.addColorStop(.5,t),c.addColorStop(1,n),i.fillStyle=c,i.translate(r,r),i.arc(0,0,a,0,2*Math.PI),i.fillStyle=c,i.fill(),e}function B(n,t){var a="hsl(100, 100%, 40%)",r=t+2,e=S(a,"hsl(100, 100%, 30%)",t),i=e.getContext("2d");return{color:a,colorName:"green",laserGradient:u(n,i,100,100,40),paint:function(n,t,a){n.drawImage(e,t-r,a-r)}}}function E(n){var t="hsl(100, 100%, 40%)",a=n+2,r=S(t,"hsl(100, 100%, 30%)",n);return I(r,n),{color:t,colorName:"green",isBomb:!0,paint:function(n,t,e){n.drawImage(r,t-a,e-a)}}}function T(n,t){var a="hsl(5, 100%, 65%)",r=t+2,e=S(a,"hsl(5, 100%, 40%)",t),i=e.getContext("2d");return{color:a,colorName:"red",laserGradient:u(n,i,5,100,65),paint:function(n,t,a){n.drawImage(e,t-r,a-r)}}}function P(n){var t="hsl(5, 100%, 65%)",a=n+2,r=S(t,"hsl(5, 100%, 40%)",n);return I(r,n),{color:t,colorName:"red",isBomb:!0,paint:function(n,t,e){n.drawImage(r,t-a,e-a)}}}function G(n,t){var a="hsl(300, 100%, 60%)",r=t+2,e=S(a,"hsl(300, 100%, 40%)",t),i=e.getContext("2d");return{color:a,colorName:"violet",laserGradient:u(n,i,300,100,60),paint:function(n,t,a){n.drawImage(e,t-r,a-r)}}}function L(n){var t="hsl(300, 100%, 60%)",a=n+2,r=S(t,"hsl(300, 100%, 40%)",n);return I(r,n),{color:t,colorName:"violet",isBomb:!0,paint:function(n,t,e){n.drawImage(r,t-a,e-a)}}}function R(n,t){var a="hsl(0, 0%, 90%)",r=t+2,e=S(a,"hsl(0, 0%, 70%)",t),i=e.getContext("2d");return{color:a,colorName:"white",laserGradient:u(n,i,0,0,90),paint:function(n,t,a){n.drawImage(e,t-r,a-r)}}}function O(n){var t="hsl(0, 0%, 90%)",a=n+2,r=S(t,"hsl(0, 0%, 70%)",n);return I(r,n),{color:t,colorName:"white",isBomb:!0,paint:function(n,t,e){n.drawImage(r,t-a,e-a)}}}function A(n,t){var a="hsl(60, 90%, 70%)",r=t+2,e=S(a,"hsl(60, 90%, 40%)",t),i=e.getContext("2d");return{color:a,colorName:"yellow",laserGradient:u(n,i,60,90,70),paint:function(n,t,a){n.drawImage(e,t-r,a-r)}}}function D(n){var t="hsl(60, 90%, 70%)",a=n+2,r=S(t,"hsl(60, 90%, 40%)",n);return I(r,n),{color:t,colorName:"yellow",isBomb:!0,paint:function(n,t,e){n.drawImage(r,t-a,e-a)}}}!function(){var n=f();document.body.appendChild(n.element)}()}();
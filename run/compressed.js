!function(){function n(n,t,a,e){var r=a/2,i=8*e,o=4*e,d=r-o/2,c=r+i,u=Math.asin(d/c),l=Math.sqrt(1-Math.pow(d/c,2))*c,f=a+i+o,v=n/2,h=t-f,s=document.createElement("canvas");s.width=n,s.height=f;var p=s.getContext("2d");return p.lineJoin=p.lineCap="round",p.translate(v,f-r),p.moveTo(-v+o,-d),p.lineTo(-l,-d),p.arc(0,0,c,-Math.PI+u,-u),p.lineTo(v-o,-d),p.strokeStyle="#555",p.lineWidth=o,p.stroke(),{paint:function(n){n.drawImage(s,0,h)}}}function t(n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var e=a.getContext("2d");return{c:e,canvas:a,clear:function(){e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(0,0,n,t)}}}function a(n,t,a,e){for(var r=16,i=r,o=2*Math.PI,d=2*e,c=[],u=0;6>u;u++){var l=m(d,d),f=m(d,d);c.push({x:n+l[0],y:t+l[1],dx:f[0],dy:f[1]})}return{id:Math.random(),paint:function(d){i==r&&a.paint(d,n,t);for(var u in c){var l=c[u],f=l.x,v=l.y;d.beginPath(),d.moveTo(f,v),d.fillStyle=a.color,d.arc(f,v,4*i/r*e,0,o),d.fill()}},tick:function(){for(var n in c){var t=c[n];t.x+=t.dx,t.y+=t.dy}return i--,i?void 0:!0}}}function e(n){var t={};return{add:function(e,r,i){var o=a(e,r,i,n);t[o.id]=o},paint:function(n){for(var a in t)t[a].paint(n)},tick:function(){for(var n in t)t[n].tick()&&delete t[n]}}}function r(n,t,a){var e=[];for(var r in n){var i=n[r];for(var o in t){var d=t[o],c=d.x-i.x,u=d.y-i.y,l=Math.hypot(c,u);if(a>l){e.push({movingBubble:i,stillBubble:d,distance:l});break}}}return e}function i(n){var t={};return{add:function(a,e,r){var i=o(a,e,r,n);t[i.id]=i},paint:function(n){for(var a in t)t[a].paint(n)},tick:function(){for(var n in t)t[n].tick()&&delete t[n]}}}function o(n,t,a,e){var r=32,i=r,o=1,d=6*(2*Math.random()-1)*e,c=0;return{id:Math.random(),paint:function(e){e.globalAlpha=o,a.paint(e,n,t),e.globalAlpha=1},tick:function(){return n+=d,t+=c,c+=e,d*=.95,i--,i?void(o=i/r):!0}}}function d(n,t,a,e,r,i){var o=2*Math.max(n,t),d=n/2,c=t-a;return{paint:function(n,t,a,r){var u=t-d,l=a-c,f=Math.hypot(u,l),v=u*o/f,h=l*o/f;-i>l/f&&(n.beginPath(),n.moveTo(d,c),n.lineTo(d+v,c+h),n.lineWidth=e,n.lineCap="round",n.strokeStyle=r,n.stroke())}}}function c(n,t,a){var e=(n-n*a)/2,r=(t-t*a)/2,i=document.createElement("canvas");return i.className="MainCanvas",i.width=n,i.height=t,i.style.transform="scale("+1/a+") translate("+e+"px, "+r+"px)",i}function u(){function a(){var n=j.get();return h(R,D,k,n)}function o(){requestAnimationFrame(function(){var n=Date.now();K.clear(),ut.clearRect(0,0,R,D),U.paint(Q),_.paint(Q),tt.paint(Q),it&&vt.paint(Q,at,et,ht.shape.laserGradient),ht&&ht.paint(Q),rt.paint(Q),Z.paint(Q),$.paint(Q),nt.visible&&nt.paint(Q),ut.drawImage(K.canvas,0,0),A.innerHTML="repaint "+(Date.now()-n),o()})}function u(){var n=Date.now();tt.tick(),rt.tick(),Z.tick(),$.tick(),nt.visible&&nt.tick(),ht&&ht.tick();for(var t=r(rt.movingBubbles,tt.stillBubbles,S),a=0;a<t.length;a++){var e=t[a],i=e.movingBubble;i.shiftBack(b-e.distance),l(i),rt.remove(i)}P.innerHTML="tick "+(Date.now()-n)}function l(n){tt.add(n),mt++,mt===gt&&(mt=0,tt.shift())}var v=devicePixelRatio,s=innerWidth*v,m=innerHeight*v,b=40*v,k=b/2,E=Math.sin(Math.PI/3)*b,L=k-1*v,S=2*L,B="MainPanel",P=document.createElement("div"),A=document.createElement("div"),O=document.createElement("div");O.className=B+"-debug",O.appendChild(A),O.appendChild(P);var R=s-s%b,D=m-m%b,H=w(L),W=M(D,L),q=C(D,L),X=I(D,L),Y=N(D,L),F=G(D,L),J=T(D,L),j=p();j.add(1,W),j.add(1,q),j.add(1,X),j.add(1,Y),j.add(1,F),j.add(1,J);var z=p();z.add(1,H),z.add(2,W),z.add(2,q),z.add(2,X),z.add(2,Y),z.add(2,F),z.add(2,J);var K=t(R,D),Q=K.c,U=n(R,D,b,v),V=Math.floor(s/b),Z=e(v),$=i(v),_=y(D,b,v),nt=g(R,D),tt=x(D,k,V,b,z.get,E,Z.add,$.add,_.add,nt.show);tt.reset();var at,et,rt=f(R,D,k,S,l,v),it=!1,ot=c(s,m,v),dt=(s-R)/2,ct=(m-D)/2,ut=ot.getContext("2d");ut.translate(dt,ct);var lt,ft=.2,vt=d(R,D,k,S,ut,ft),ht=a(),st=null,pt=document.createElement("div");pt.className=B,pt.appendChild(ot),pt.appendChild(O),pt.addEventListener("touchstart",function(n){if(ht&&ht.ready&&!nt.showing&&!nt.hiding){if(nt.visible)return nt.hide(),tt.reset(),void _.reset();if(null===st){var t=n.changedTouches[0];at=t.clientX*v-dt,et=t.clientY*v-ct,st=t.identifier,it=!0}}}),pt.addEventListener("touchmove",function(n){for(var t=n.changedTouches,a=0;a<t.length;a++){var e=t[a];e.identifier===st&&(at=e.clientX*v-dt,et=e.clientY*v-ct)}}),pt.addEventListener("touchend",function(n){for(var t=n.changedTouches,e=0;e<t.length;e++){var r=t[e];if(r.identifier===st){it=!1;var r=n.changedTouches[0],i=at-R/2,o=D-k-et,d=Math.hypot(i,o),c=i/d,u=-o/d;if(-ft>u){var l=ht.shape;rt.add(l,c,u),ht=null,lt=setTimeout(function(){ht=a()},200),st=null}}}});var mt=0,gt=7;return addEventListener("keydown",function(n){32==n.keyCode&&u()}),setInterval(u,20),o(),{element:pt}}function l(n,t,a,e,r,i,o,d){var c=20*d,u=i*c,l=o*c,f={id:Math.random(),shape:r,x:n/2,y:t-a,paint:function(n){r.paint(n,f.x,f.y)},shiftBack:function(t){var e=Math.hypot(i,o);f.x-=i*t/e,f.y-=o*t/e;var r=a-f.x;r>0&&(f.x+=2*r);var d=f.x+a-n;d>0&&(f.x-=2*d)},tick:function(){f.x+=u,f.y+=l;var t=a-f.x;t>0&&(f.x+=2*t,i=-i,u=i*c);var e=f.x+a-n;return e>0&&(f.x-=2*e,i=-i,u=i*c),f.y<=a?(f.y=a,!0):void 0}};return f}function f(n,t,a,e,r,i){function o(n){delete d[n.id]}var d={};return{movingBubbles:d,remove:o,add:function(r,o,c){var u=l(n,t,a,e,r,o,c,i);d[u.id]=u},paint:function(n){for(var t in d)d[t].paint(n)},tick:function(){for(var n in d){var t=d[n];t.tick()&&(r(t),o(t))}}}}function v(n,t){function a(n,t){var a=r[n];if(a){var i=a[t];i&&!l[i.id]&&i.shape==u&&e(i)}}function e(n){var t=n.colNumber,e=n.rowNumber;l[n.id]=n,f.push(n),a(t-2,e),a(t+2,e),a(t-1,e-1),a(t+1,e-1),a(t-1,e+1),a(t+1,e+1)}var r={};for(var i in t){var o=t[i];r[i]={};for(var d in o){var c=o[d];r[i][c.rowNumber]=c}}var u=n.shape,l={},f=[];return e(n),f}function h(n,t,a,e){var r=n/2,i=t+a,o=8,d=0,c=2*a/o,u={ready:!1,shape:e,paint:function(n){n.globalAlpha=d/o,e.paint(n,r,i),n.globalAlpha=1},tick:function(){o>d?(d++,i-=c):u.ready=!0}};return u}function s(n){function t(n,t){var e=i[n];if(e){var o=e[t];if(o){var d=o.id;f[d]||(f[d]=!0,delete r[d],a(o))}}}function a(n){var a=n.colNumber,e=n.rowNumber;t(a-1,e-1),t(a+1,e-1),t(a-2,e),t(a+2,e),t(a-1,e+1),t(a+1,e+1)}var e=[],r={},i={};for(var o in n){var d=n[o];i[o]={};for(var c in d){var u=d[c],l=u.rowNumber;l?(i[o][l]=u,r[u.id]=u):e.push(u)}}for(var f={},o=0;o<e.length;o++)a(e[o]);return r}function p(){var n=[],t=0;return{add:function(a,e){n.push({chance:a,shape:e}),t+=a},get:function(){var a=Math.random()*t;for(var e in n){var r=n[e];if(a-=r.chance,0>a)return r.shape}}}}function m(n,t){var a=Math.random()*Math.PI*2,e=n+Math.random()*t,r=Math.cos(a)*e,i=Math.sin(a)*e;return[r,i]}function g(n,t){function a(){r&&r--,r||(d.visible=!1,d.hiding=!1),o=r/i}function e(){i>r?r++:d.showing=!1,o=r/i}var r=0,i=24,o=0,d={tick:e,hiding:!1,showing:!1,visible:!1,hide:function(){d.showing=!1,d.tick=a,d.hiding=!0},paint:function(a){a.fillStyle="rgba(0, 0, 0, "+.7*o+")",a.fillRect(0,0,n,t)},show:function(){d.visible=!0,d.hiding=!1,d.tick=e,d.showing=!0}};return d}function b(n,t,a,e,r){var i={colNumber:r,id:Math.random(),rowNumber:e,shape:a,x:n,y:t,paint:function(t){a.paint(t,n,i.y)}};return i}function x(n,t,a,e,r,i,o,d,c,u){function l(n){var t=n.id;k[t]=n,I[n.colNumber][t]=n,f(n)}function f(n){!L.gameOver&&n.rowNumber>=G&&(L.gameOver=!0,u())}function h(n,a){for(var o=t+n*t,d=t-i-w,c=0;a>c;c++){var u=r(),f=b(o,d,u,0,n);l(f),p(f,x+M),o+=e,n+=2}}function p(n,t){var a=n.id;C[a]?C[a].steps+=t:C[a]={steps:t,bubble:n}}function m(n){var t=n.id;delete k[t],delete I[n.colNumber][t]}function g(){for(var n in k){var t=k[n];p(t,x),t.rowNumber++,f(t)}T?h(1,a-1):h(0,a),T=!T,w+=i,M+=x}for(var x=4,y=i/x,w=0,M=0,k={},C={},I={},N=0;2*a-1>N;N++)I[N]={};var G=Math.floor((n-e)/i),T=!1,E=3,L={gameOver:!1,shift:g,stillBubbles:k,add:function(n){var a=n.y,r=M*y-t,u=Math.round((a+r)/i);a=u*i-r;var f=(u+(T?1:0))%2?t:0,h=n.x;h=Math.round((h-f)/e)*e+f;var g=Math.floor(h/t)-1,x=b(h,a,n.shape,u,g);l(x),M&&p(x,M);var w=v(x,I);if(w.length>=E){c(w.length-E+1);for(var k=0;k<w.length;k++){var C=w[k];m(C),o(C.x,C.y,C.shape)}var N=s(I);for(var k in N){var G=N[k];m(G),d(G.x,G.y,G.shape)}}},isOdd:function(){return T},paint:function(n){for(var t in k)k[t].paint(n)},reset:function(){L.gameOver=!1,C={};for(var n in k)delete k[n];for(var n in I){var t=I[n];for(var n in t)delete t[n]}g(),g(),g()},tick:function(){for(var n in C){var t=C[n];t.steps--,t.bubble.y+=y,t.steps||(delete C[n],n--)}M&&(M--,w-=y)}};return L}function y(n,t,a){var e=0,r=10*a,i=n-t+10*a,o="bold "+26*a+"px Arial, sans-serif";return{add:function(n){e+=n},paint:function(n){n.textBaseline="top",n.font=o,n.fillStyle="#777",n.fillText(e,r,i)},reset:function(){e=0}}}function w(n){var t="hsl(0, 0%, 40%)",a=n+2,e=k(t,"hsl(0, 0%, 15%)",n);return{color:t,paint:function(n,t,r){n.drawImage(e,t-a,r-a)}}}function M(n,t){var a="hsl(220, 100%, 70%)",e=t+2,r=k(a,"hsl(220, 100%, 55%)",t),i=r.getContext("2d");return{color:a,laserGradient:LaserGradient(n,i,220,100,70),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function k(n,t,a){var e=a+2,r=document.createElement("canvas");r.width=r.height=2*e;var i=r.getContext("2d"),o=-a/2,d=i.createRadialGradient(0,o,0,0,o,2*a);return d.addColorStop(0,n),d.addColorStop(.5,t),d.addColorStop(1,n),i.fillStyle=d,i.translate(e,e),i.arc(0,0,a,0,2*Math.PI),i.fillStyle=d,i.fill(),r}function C(n,t){var a="hsl(100, 100%, 40%)",e=t+2,r=k(a,"hsl(100, 100%, 30%)",t),i=r.getContext("2d");return{color:a,laserGradient:LaserGradient(n,i,100,100,40),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function I(n,t){var a="hsl(5, 100%, 65%)",e=t+2,r=k(a,"hsl(5, 100%, 40%)",t),i=r.getContext("2d");return{color:a,laserGradient:LaserGradient(n,i,5,100,65),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function N(n,t){var a="hsl(300, 100%, 60%)",e=t+2,r=k(a,"hsl(300, 100%, 40%)",t),i=r.getContext("2d");return{color:a,laserGradient:LaserGradient(n,i,300,100,60),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function G(n,t){var a="hsl(0, 0%, 90%)",e=t+2,r=k(a,"hsl(0, 0%, 70%)",t),i=r.getContext("2d");return{color:a,laserGradient:LaserGradient(n,i,0,0,90),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}function T(n,t){var a="hsl(60, 90%, 70%)",e=t+2,r=k(a,"hsl(60, 90%, 40%)",t),i=r.getContext("2d");return{color:a,laserGradient:LaserGradient(n,i,60,90,70),paint:function(n,t,a){n.drawImage(r,t-e,a-e)}}}!function(){var n=u();document.body.appendChild(n.element)}()}();